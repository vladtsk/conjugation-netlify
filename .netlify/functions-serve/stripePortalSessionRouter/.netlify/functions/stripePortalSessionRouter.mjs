
import {createRequire as ___nfyCreateRequire} from "module";
import {fileURLToPath as ___nfyFileURLToPath} from "url";
import {dirname as ___nfyPathDirname} from "path";
let __filename=___nfyFileURLToPath(import.meta.url);
let __dirname=___nfyPathDirname(___nfyFileURLToPath(import.meta.url));
let require=___nfyCreateRequire(import.meta.url);


// .netlify/functions/stripePortalSessionRouter.js
import dotenv from "dotenv";
import express, { Router } from "express";
import Stripe from "stripe";
dotenv.config();
var portalSessionRouter = Router();
var stripe = new Stripe(process.env.STRIPE_PRIVATE_KEY);
portalSessionRouter.post("/create-portal-session", async (req, res) => {
  const { stripeCustomerID } = req.body;
  const returnUrl = process.env.CLIENT_URL;
  if (stripeCustomerID) {
    try {
      const portalSession = await stripe.billingPortal.sessions.create({
        customer: stripeCustomerID,
        return_url: returnUrl
      });
      res.redirect(303, portalSession.url);
    } catch (error) {
      console.error("Error creating Stripe billing portal session:", error);
      res.redirect(303, `${returnUrl}/error.html`);
    }
  } else {
    res.redirect(303, `${returnUrl}/error.html`);
  }
});
var stripePortalSessionRouter_default = portalSessionRouter;
export {
  stripePortalSessionRouter_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLm5ldGxpZnkvZnVuY3Rpb25zL3N0cmlwZVBvcnRhbFNlc3Npb25Sb3V0ZXIuanMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xyXG5pbXBvcnQgZXhwcmVzcywgeyBSb3V0ZXIgfSBmcm9tIFwiZXhwcmVzc1wiO1xyXG5cclxuaW1wb3J0IFN0cmlwZSBmcm9tIFwic3RyaXBlXCI7XHJcblxyXG5kb3RlbnYuY29uZmlnKCk7XHJcblxyXG5jb25zdCBwb3J0YWxTZXNzaW9uUm91dGVyID0gUm91dGVyKCk7XHJcblxyXG5jb25zdCBzdHJpcGUgPSBuZXcgU3RyaXBlKHByb2Nlc3MuZW52LlNUUklQRV9QUklWQVRFX0tFWSk7XHJcblxyXG5wb3J0YWxTZXNzaW9uUm91dGVyLnBvc3QoXCIvY3JlYXRlLXBvcnRhbC1zZXNzaW9uXCIsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIC8vaHR0cHM6Ly9kb2NzLnN0cmlwZS5jb20vY3VzdG9tZXItbWFuYWdlbWVudC9pbnRlZ3JhdGUtY3VzdG9tZXItcG9ydGFsXHJcbiAgY29uc3QgeyBzdHJpcGVDdXN0b21lcklEIH0gPSByZXEuYm9keTtcclxuXHJcbiAgLy8gVGhpcyBpcyB0aGUgdXJsIHRvIHdoaWNoIHRoZSBjdXN0b21lciB3aWxsIGJlIHJlZGlyZWN0ZWQgd2hlbiB0aGV5IGFyZSBkb25lIG1hbmFnaW5nIHRoZWlyIGJpbGxpbmcgd2l0aCB0aGUgcG9ydGFsLlxyXG4gIGNvbnN0IHJldHVyblVybCA9IHByb2Nlc3MuZW52LkNMSUVOVF9VUkw7XHJcblxyXG4gIGlmIChzdHJpcGVDdXN0b21lcklEKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBwb3J0YWxTZXNzaW9uID0gYXdhaXQgc3RyaXBlLmJpbGxpbmdQb3J0YWwuc2Vzc2lvbnMuY3JlYXRlKHtcclxuICAgICAgICBjdXN0b21lcjogc3RyaXBlQ3VzdG9tZXJJRCxcclxuICAgICAgICByZXR1cm5fdXJsOiByZXR1cm5VcmwsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVzLnJlZGlyZWN0KDMwMywgcG9ydGFsU2Vzc2lvbi51cmwpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIFN0cmlwZSBiaWxsaW5nIHBvcnRhbCBzZXNzaW9uOlwiLCBlcnJvcik7XHJcbiAgICAgIC8vIFJlZGlyZWN0IHRvIGFuIGVycm9yIHBhZ2Ugb3IgcmV0dXJuIGFuIGVycm9yIHJlc3BvbnNlXHJcbiAgICAgIHJlcy5yZWRpcmVjdCgzMDMsIGAke3JldHVyblVybH0vZXJyb3IuaHRtbGApO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyBSZWRpcmVjdCB0byBhbiBlcnJvciBwYWdlIGlmIHN0cmlwZUN1c3RvbWVySUQgaXMgbm90IHByb3ZpZGVkXHJcbiAgICByZXMucmVkaXJlY3QoMzAzLCBgJHtyZXR1cm5Vcmx9L2Vycm9yLmh0bWxgKTtcclxuICB9XHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcG9ydGFsU2Vzc2lvblJvdXRlcjtcclxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7OztBQUFBLE9BQU8sWUFBWTtBQUNuQixPQUFPLFdBQVcsY0FBYztBQUVoQyxPQUFPLFlBQVk7QUFFbkIsT0FBTyxPQUFPO0FBRWQsSUFBTSxzQkFBc0IsT0FBTztBQUVuQyxJQUFNLFNBQVMsSUFBSSxPQUFPLFFBQVEsSUFBSSxrQkFBa0I7QUFFeEQsb0JBQW9CLEtBQUssMEJBQTBCLE9BQU8sS0FBSyxRQUFRO0FBRXJFLFFBQU0sRUFBRSxpQkFBaUIsSUFBSSxJQUFJO0FBR2pDLFFBQU0sWUFBWSxRQUFRLElBQUk7QUFFOUIsTUFBSSxrQkFBa0I7QUFDcEIsUUFBSTtBQUNGLFlBQU0sZ0JBQWdCLE1BQU0sT0FBTyxjQUFjLFNBQVMsT0FBTztBQUFBLFFBQy9ELFVBQVU7QUFBQSxRQUNWLFlBQVk7QUFBQSxNQUNkLENBQUM7QUFFRCxVQUFJLFNBQVMsS0FBSyxjQUFjLEdBQUc7QUFBQSxJQUNyQyxTQUFTLE9BQU87QUFDZCxjQUFRLE1BQU0saURBQWlELEtBQUs7QUFFcEUsVUFBSSxTQUFTLEtBQUssR0FBRyxTQUFTLGFBQWE7QUFBQSxJQUM3QztBQUFBLEVBQ0YsT0FBTztBQUVMLFFBQUksU0FBUyxLQUFLLEdBQUcsU0FBUyxhQUFhO0FBQUEsRUFDN0M7QUFDRixDQUFDO0FBRUQsSUFBTyxvQ0FBUTsiLAogICJuYW1lcyI6IFtdCn0K
